<html><head>
		<script src="https://d3js.org/d3.v4.js"></script>
        <script src="dataLoader.js"></script>
        <script src="getNode.js"></script>

		<style>
      		@import url('https://fonts.googleapis.com/css2?family=Noto+Serif+JP:wght@900&display=swap');

		    div, ul {
		      border: solid black 1px;
		      margin: 5px;
		      padding: 10px;
		      background-color: rgba(255, 255, 128, 0.1);
		    }

		    div:hover, ul:hover {
		      background-color: rgba(255, 128, 128, 0.1);
		    }

			html, body {
				height: 100%;
				width: 100%;
				padding: 0;
				margin: 0;
				padding: 10px;
		        background-color: rgba(255, 255, 0, 0.02);
			}

			svg {
		        font-family: 'Noto Serif JP', serif;
			}

			#dropfile {
				height: 5%;
				width: 100%;
				border-style: dotted;;
				display: block;
				text-align: center;
			    animation-name: oxxo;
			    animation-duration: 2s;
			    animation-iteration-count: infinite;
			    padding: 10px;
		        background-color: rgba(255, 255, 0, 0.1);
		        font-family: 'Noto Serif JP', serif;
		        margin-bottom: 10px;
			}
			#dropfile:hover {
			    background-color: rgba(128, 255, 255, 0.1);
			}
			@keyframes oxxo{
			    from {
			        border-style: dotted;;
			        border-color: blue;
			        color: blue;
			    }
			    to {
			        border-style: solid;
			        border-color: red;
			        color: crimson;
			    }
			}

			#treemap {
				height: 95%;
				width: 100%;
			}
		</style>
	</head>
	<body>
		<div>
			Lab 02 treemap
		</div>
		<ul>
			<li>遠距教學授課防疫演練: 2021.03.18 (四) </li>
			<li>上台報告: 2021.04.01 (四) </li>
			<li><a href="https://www.d3-graph-gallery.com/graph/treemap_custom.html">Treemap customization in d3.js</a></li>
			<li><a href="http://blog.infographics.tw/2015/10/d3js-tutorial-treemap-and-budget/">D3.js 實戰 － 利用 Treemap Layout 將政府預算視覺化</a></li>
		</ul>

		<div id="dropfile" for="csvfile">
			CSV 資料扔過來! Drop your CSV here.
		</div>
		<!--
		<div>
			<select id="ObjectKeys"><option value="年分">年分</option><option value="亞洲地區">亞洲地區</option><option value="非洲地區">非洲地區</option><option value="美洲地區">美洲地區</option><option value="大洋洲地區">大洋洲地區</option><option value="歐洲地區">歐洲地區</option></select>
		</div>
		-->

		<div id="treemap">
			<li>2014-2020各洲入境台灣旅客分布數 </li>
			<svg width="2023" height="924"><g><rect x="0" y="70" width="282.9475777211505" height="392.04921967674807" style="stroke: red; fill: rgb(177, 157, 76); opacity: 0.924642;"></rect><rect x="287.9475777211505" y="70" width="123.92500445367494" height="197.28139552447794" style="stroke: red; fill: rgb(177, 157, 76); opacity: 0.500376;"></rect><rect x="416.8725821748254" y="70" width="150.96823381067452" height="197.28139552447794" style="stroke: red; fill: rgb(177, 157, 76); opacity: 0.526675;"></rect><rect x="287.9475777211505" y="272.28139552447794" width="279.8932382643498" height="89.41491813941548" style="stroke: red; fill: rgb(177, 157, 76); opacity: 0.504314;"></rect><rect x="287.9475777211505" y="366.6963136638934" width="279.8932382643498" height="95.35290601285465" style="stroke: red; fill: rgb(177, 157, 76); opacity: 0.512447;"></rect><rect x="0" y="502.04921967674807" width="288.6061366080378" height="401.95078032325193" style="stroke: red; fill: rgb(189, 179, 18); opacity: 0.948287;"></rect><rect x="293.6061366080378" y="502.04921967674807" width="120.8786603212061" height="202.60157540539296" style="stroke: red; fill: rgb(189, 179, 18); opacity: 0.500386;"></rect><rect x="419.4847969292439" y="502.04921967674807" width="148.35601905625617" height="202.60157540539296" style="stroke: red; fill: rgb(189, 179, 18); opacity: 0.527755;"></rect><rect x="293.6061366080378" y="709.650795082141" width="274.23467937746227" height="91.43693666847844" style="stroke: red; fill: rgb(189, 179, 18); opacity: 0.504205;"></rect><rect x="293.6061366080378" y="806.0877317506195" width="274.23467937746227" height="97.91226824938053" style="stroke: red; fill: rgb(189, 179, 18); opacity: 0.51288;"></rect><rect x="587.8408159855001" y="70" width="296.26488808484487" height="396.4969892302041" style="stroke: red; fill: rgb(86, 106, 194); opacity: 0.955638;"></rect><rect x="889.1057040703449" y="70" width="122.2658525914386" height="200.2792838164446" style="stroke: red; fill: rgb(86, 106, 194); opacity: 0.50041;"></rect><rect x="1016.3715566617835" y="70" width="152.9543349400982" height="200.2792838164446" style="stroke: red; fill: rgb(86, 106, 194); opacity: 0.530651;"></rect><rect x="889.1057040703449" y="275.2792838164446" width="280.2201875315368" height="89.62408248538566" style="stroke: red; fill: rgb(86, 106, 194); opacity: 0.504556;"></rect><rect x="889.1057040703449" y="369.90336630183026" width="280.2201875315368" height="96.59362292837386" style="stroke: red; fill: rgb(86, 106, 194); opacity: 0.514098;"></rect><rect x="587.8408159855001" y="506.4969892302041" width="294.6123356937104" height="397.5030107697959" style="stroke: red; fill: rgb(216, 163, 72); opacity: 0.953783;"></rect><rect x="887.4531516792105" y="506.4969892302041" width="121.9036069292996" height="200.9853494424699" style="stroke: red; fill: rgb(216, 163, 72); opacity: 0.500458;"></rect><rect x="1014.3567586085101" y="506.4969892302041" width="154.96913299337166" height="200.9853494424699" style="stroke: red; fill: rgb(216, 163, 72); opacity: 0.533147;"></rect><rect x="887.4531516792105" y="712.482338672674" width="281.87273992267126" height="89.44581786515687" style="stroke: red; fill: rgb(216, 163, 72); opacity: 0.505035;"></rect><rect x="887.4531516792105" y="806.9281565378309" width="281.87273992267126" height="97.07184346216911" style="stroke: red; fill: rgb(216, 163, 72); opacity: 0.515534;"></rect><rect x="1189.3258916018817" y="70" width="375.31643240114136" height="324.2865470507427" style="stroke: red; fill: rgb(68, 207, 235); opacity: 0.9661;"></rect><rect x="1189.3258916018817" y="399.2865470507427" width="189.56516689796013" height="131.63087632874613" style="stroke: red; fill: rgb(68, 207, 235); opacity: 0.500475;"></rect><rect x="1189.3258916018817" y="535.9174233794888" width="189.56516689796013" height="168.77674653833947" style="stroke: red; fill: rgb(68, 207, 235); opacity: 0.534587;"></rect><rect x="1383.8910584998418" y="399.2865470507427" width="180.75126550318123" height="144.03635875781777" style="stroke: red; fill: rgb(68, 207, 235); opacity: 0.505667;"></rect><rect x="1383.8910584998418" y="548.3229058085604" width="180.75126550318123" height="156.37126410926783" style="stroke: red; fill: rgb(68, 207, 235); opacity: 0.516482;"></rect><rect x="1584.642324003023" y="70" width="388.3576759969769" height="332.0522549891893" style="stroke: red; fill: rgb(197, 65, 128); opacity: 1;"></rect><rect x="1584.642324003023" y="407.0522549891893" width="195.94660127128532" height="127.48353228490288" style="stroke: red; fill: rgb(197, 65, 128); opacity: 0.500498;"></rect><rect x="1584.642324003023" y="539.5357872740922" width="195.94660127128532" height="165.1583826437361" style="stroke: red; fill: rgb(197, 65, 128); opacity: 0.536187;"></rect><rect x="1785.5889252743084" y="407.0522549891893" width="87.02550934224018" height="297.641914928639" style="stroke: red; fill: rgb(197, 65, 128); opacity: 0.50629;"></rect><rect x="1877.6144346165486" y="407.0522549891893" width="95.38556538345142" height="297.641914928639" style="stroke: red; fill: rgb(197, 65, 128); opacity: 0.518217;"></rect><rect x="1189.3258916018817" y="744.6941699178283" width="201.96066866908973" height="159.30583008217172" style="stroke: red; fill: rgb(14, 203, 126); opacity: 0.555966;"></rect><rect x="1396.2865602709714" y="744.6941699178283" width="137.98168086153873" height="159.30583008217172" style="stroke: red; fill: rgb(14, 203, 126); opacity: 0.500023;"></rect><rect x="1539.2682411325102" y="744.6941699178283" width="143.59257124244027" height="159.30583008217172" style="stroke: red; fill: rgb(14, 203, 126); opacity: 0.504929;"></rect><rect x="1687.8608123749505" y="744.6941699178283" width="139.0703392625196" height="159.30583008217172" style="stroke: red; fill: rgb(14, 203, 126); opacity: 0.500975;"></rect><rect x="1831.93115163747" y="744.6941699178283" width="141.0688483625297" height="159.30583008217172" style="stroke: red; fill: rgb(14, 203, 126); opacity: 0.502723;"></rect><text x="1" y="90" font-size="1rem" fill="white">亞洲地區</text><text x="288.9475777211505" y="90" font-size="1rem" fill="white">非洲地區</text><text x="417.8725821748254" y="90" font-size="1rem" fill="white">美洲地區</text><text x="288.9475777211505" y="292.28139552447794" font-size="1rem" fill="white">大洋洲地區</text><text x="288.9475777211505" y="386.6963136638934" font-size="1rem" fill="white">歐洲地區</text><text x="1" y="522.0492196767481" font-size="1rem" fill="white">亞洲地區</text><text x="294.6061366080378" y="522.0492196767481" font-size="1rem" fill="white">非洲地區</text><text x="420.4847969292439" y="522.0492196767481" font-size="1rem" fill="white">美洲地區</text><text x="294.6061366080378" y="729.650795082141" font-size="1rem" fill="white">大洋洲地區</text><text x="294.6061366080378" y="826.0877317506195" font-size="1rem" fill="white">歐洲地區</text><text x="588.8408159855001" y="90" font-size="1rem" fill="white">亞洲地區</text><text x="890.1057040703449" y="90" font-size="1rem" fill="white">非洲地區</text><text x="1017.3715566617835" y="90" font-size="1rem" fill="white">美洲地區</text><text x="890.1057040703449" y="295.2792838164446" font-size="1rem" fill="white">大洋洲地區</text><text x="890.1057040703449" y="389.90336630183026" font-size="1rem" fill="white">歐洲地區</text><text x="588.8408159855001" y="526.4969892302041" font-size="1rem" fill="white">亞洲地區</text><text x="888.4531516792105" y="526.4969892302041" font-size="1rem" fill="white">非洲地區</text><text x="1015.3567586085101" y="526.4969892302041" font-size="1rem" fill="white">美洲地區</text><text x="888.4531516792105" y="732.482338672674" font-size="1rem" fill="white">大洋洲地區</text><text x="888.4531516792105" y="826.9281565378309" font-size="1rem" fill="white">歐洲地區</text><text x="1190.3258916018817" y="90" font-size="1rem" fill="white">亞洲地區</text><text x="1190.3258916018817" y="419.2865470507427" font-size="1rem" fill="white">非洲地區</text><text x="1190.3258916018817" y="555.9174233794888" font-size="1rem" fill="white">美洲地區</text><text x="1384.8910584998418" y="419.2865470507427" font-size="1rem" fill="white">大洋洲地區</text><text x="1384.8910584998418" y="568.3229058085604" font-size="1rem" fill="white">歐洲地區</text><text x="1585.642324003023" y="90" font-size="1rem" fill="white">亞洲地區</text><text x="1585.642324003023" y="427.0522549891893" font-size="1rem" fill="white">非洲地區</text><text x="1585.642324003023" y="559.5357872740922" font-size="1rem" fill="white">美洲地區</text><text x="1786.5889252743084" y="427.0522549891893" font-size="1rem" fill="white">大洋洲地區</text><text x="1878.6144346165486" y="427.0522549891893" font-size="1rem" fill="white">歐洲地區</text><text x="1190.3258916018817" y="764.6941699178283" font-size="1rem" fill="white">亞洲地區</text><text x="1397.2865602709714" y="764.6941699178283" font-size="1rem" fill="white">非洲地區</text><text x="1540.2682411325102" y="764.6941699178283" font-size="1rem" fill="white">美洲地區</text><text x="1688.8608123749505" y="764.6941699178283" font-size="1rem" fill="white">大洋洲地區</text><text x="1832.93115163747" y="764.6941699178283" font-size="1rem" fill="white">歐洲地區</text><text x="1" y="105" font-size=".9rem" fill="white">8970186</text><text x="288.9475777211505" y="105" font-size=".9rem" fill="white">9960</text><text x="417.8725821748254" y="105" font-size=".9rem" fill="white">565375</text><text x="288.9475777211505" y="307.28139552447794" font-size=".9rem" fill="white">93119</text><text x="288.9475777211505" y="401.6963136638934" font-size=".9rem" fill="white">264880</text><text x="1" y="537.0492196767481" font-size=".9rem" fill="white">9469559</text><text x="294.6061366080378" y="537.0492196767481" font-size=".9rem" fill="white">10160</text><text x="420.4847969292439" y="537.0492196767481" font-size=".9rem" fill="white">588192</text><text x="294.6061366080378" y="744.650795082141" font-size=".9rem" fill="white">90813</text><text x="294.6061366080378" y="841.0877317506195" font-size=".9rem" fill="white">274035</text><text x="588.8408159855001" y="105" font-size=".9rem" fill="white">9624793</text><text x="890.1057040703449" y="105" font-size=".9rem" fill="white">10668</text><text x="1017.3715566617835" y="105" font-size=".9rem" fill="white">649337</text><text x="890.1057040703449" y="310.2792838164446" font-size=".9rem" fill="white">98226</text><text x="890.1057040703449" y="404.90336630183026" font-size=".9rem" fill="white">299756</text><text x="588.8408159855001" y="541.4969892302041" font-size=".9rem" fill="white">9585635</text><text x="888.4531516792105" y="541.4969892302041" font-size=".9rem" fill="white">11682</text><text x="1015.3567586085101" y="541.4969892302041" font-size=".9rem" fill="white">702049</text><text x="888.4531516792105" y="747.482338672674" font-size=".9rem" fill="white">108344</text><text x="888.4531516792105" y="841.9281565378309" font-size=".9rem" fill="white">330090</text><text x="1190.3258916018817" y="105" font-size=".9rem" fill="white">9845751</text><text x="1190.3258916018817" y="434.2865470507427" font-size=".9rem" fill="white">12037</text><text x="1190.3258916018817" y="570.9174233794888" font-size=".9rem" fill="white">732478</text><text x="1384.8910584998418" y="434.2865470507427" font-size=".9rem" fill="white">121697</text><text x="1384.8910584998418" y="583.3229058085604" font-size=".9rem" fill="white">350094</text><text x="1585.642324003023" y="105" font-size=".9rem" fill="white">10561699</text><text x="1585.642324003023" y="442.0522549891893" font-size=".9rem" fill="white">12537</text><text x="1585.642324003023" y="574.5357872740922" font-size=".9rem" fill="white">766254</text><text x="1786.5889252743084" y="442.0522549891893" font-size=".9rem" fill="white">134860</text><text x="1878.6144346165486" y="442.0522549891893" font-size=".9rem" fill="white">386752</text><text x="1190.3258916018817" y="779.6941699178283" font-size=".9rem" fill="white">1183987</text><text x="1397.2865602709714" y="779.6941699178283" font-size=".9rem" fill="white">2502</text><text x="1540.2682411325102" y="779.6941699178283" font-size=".9rem" fill="white">106117</text><text x="1688.8608123749505" y="779.6941699178283" font-size=".9rem" fill="white">22606</text><text x="1832.93115163747" y="779.6941699178283" font-size=".9rem" fill="white">59512</text><text x="1" y="56" font-size="1.1rem" fill="black">2014</text><text x="1" y="488.04921967674807" font-size="1.1rem" fill="black">2015</text><text x="588.8408159855001" y="56" font-size="1.1rem" fill="black">2016</text><text x="588.8408159855001" y="492.4969892302041" font-size="1.1rem" fill="black">2017</text><text x="1190.3258916018817" y="56" font-size="1.1rem" fill="black">2018</text><text x="1585.642324003023" y="56" font-size="1.1rem" fill="black">2019</text><text x="1190.3258916018817" y="730.6941699178283" font-size="1.1rem" fill="black">2020</text></g></svg></div>


		<script>
			var Base64 = { _keyStr: "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=", encode: function (r) { var t, e, o, a, h, c, n = "", d = 0; for (r = Base64._utf8_encode(r); d < r.length;)o = (c = r.charCodeAt(d++)) >> 2, a = (3 & c) << 4 | (t = r.charCodeAt(d++)) >> 4, h = (15 & t) << 2 | (e = r.charCodeAt(d++)) >> 6, c = 63 & e, isNaN(t) ? h = c = 64 : isNaN(e) && (c = 64), n = n + this._keyStr.charAt(o) + this._keyStr.charAt(a) + this._keyStr.charAt(h) + this._keyStr.charAt(c); return n }, decode: function (r) { var t, e, o, a, h, c = "", n = 0; for (r = r.replace(/[^A-Za-z0-9\+\/\=]/g, ""); n < r.length;)t = this._keyStr.indexOf(r.charAt(n++)) << 2 | (o = this._keyStr.indexOf(r.charAt(n++))) >> 4, e = (15 & o) << 4 | (a = this._keyStr.indexOf(r.charAt(n++))) >> 2, o = (3 & a) << 6 | (h = this._keyStr.indexOf(r.charAt(n++))), c += String.fromCharCode(t), 64 != a && (c += String.fromCharCode(e)), 64 != h && (c += String.fromCharCode(o)); return c = Base64._utf8_decode(c) }, _utf8_encode: function (r) { r = r.replace(/\r\n/g, "\n"); for (var t = "", e = 0; e < r.length; e++) { var o = r.charCodeAt(e); o < 128 ? t += String.fromCharCode(o) : (127 < o && o < 2048 ? t += String.fromCharCode(o >> 6 | 192) : (t += String.fromCharCode(o >> 12 | 224), t += String.fromCharCode(o >> 6 & 63 | 128)), t += String.fromCharCode(63 & o | 128)) } return t }, _utf8_decode: function (r) { for (var t = "", e = 0, o = c1 = c2 = 0; e < r.length;)(o = r.charCodeAt(e)) < 128 ? (t += String.fromCharCode(o), e++) : 191 < o && o < 224 ? (c2 = r.charCodeAt(e + 1), t += String.fromCharCode((31 & o) << 6 | 63 & c2), e += 2) : (c2 = r.charCodeAt(e + 1), c3 = r.charCodeAt(e + 2), t += String.fromCharCode((15 & o) << 12 | (63 & c2) << 6 | 63 & c3), e += 3); return t } };
		</script>

		<script>
			var csvData = null
			window.addEventListener('load', function(){
                var treemapContainer = document.getElementById('treemap')
                var objectKeys = document.getElementById("ObjectKeys")

                document.getElementById("ObjectKeys").addEventListener('change', function(evt){
					if(evt.target.value == 'selectValue' ){
						return;
					}

                    //clear container
                    if (treemapContainer.innerHTML.length) {
                        treemapContainer.innerHTML = ''
                    }


                    dataClassifier(objectKeys.value, function(data, layers){
                        node = getNode(data, layers, treemapContainer)
                        treemapContainer.appendChild(node)
                    })
				})

				document.getElementById('dropfile').addEventListener('dragover',function(evt){
					evt.preventDefault()
				})

				document.getElementById('dropfile').addEventListener('drop', function(evt){
					evt.preventDefault()

					var files = evt.dataTransfer.files

					if (files.length) {
                        if (treemapContainer.innerHTML.length) {
                            treemapContainer.innerHTML = ''
                        }

                        if (objectKeys.innerHTML.length) {
                            objectKeys.innerHTML = ''
						}

						var csvFile = files[0]

						//讀取csv
						var fr = new FileReader()

                        fr.onload = function(){
                            dataLoader(fr.result, function(){
								dataClassifier(objectKeys.value, function(data, layers){
									node = getNode(data, layers, treemapContainer)
									treemapContainer.innerHTML = node.innerHTML
								})
							})
                        }

						fr.readAsText(csvFile)
					}
				})
			})
		</script>




</body></html>
